%section.content-header
  %h1
    Invoice
    %small= @invoice.invoice_number
    - unless is_pdf_view?
      .row.no-print
        .col-xs-12
          = link_to edit_invoice_path(@invoice), method: :get, class: "btn btn-primary btn-flat pull-right invoice_margin"  do
            %i.fa.fa-credit-card
            Edit
          = link_to new_invoice_payment_path(@invoice), class: "btn btn-primary btn-flat pull-right invoice_margin"  do
            %i.fa.fa-credit-card
            Make Payment
          = link_to invoice_generate_pdf_path(@invoice), method: :post, class: "btn btn-primary btn-flat pull-right invoice_margin"  do
            %i.fa.fa-download
            Download as PDF
%section.invoice
  .row
    .col-xs-12
      %h2.page-header
        %i.fa.fa-globe
        = current_company.name
        %small.pull-right
          Date: #{l Date.today}
  .row.invoice-info
    .col-xs-4.invoice-col
      From
      %address
        %strong= current_company.name
        %br
          = current_company.address.street_1
          %br
            = "#{current_company.address.city}, #{current_company.address.state}, #{current_company.address.pincode}"
    .col-xs-4.invoice-col
      To
      %address
        %strong
          = @invoice.client.contact_details.first.first_name
          = @invoice.client.contact_details.first.last_name
        %br
          = @invoice.address.street_1
          %br
            = @invoice.address.city
            , #{@invoice.address.state}, #{@invoice.address.pincode}
            %br
              Phone: #{@invoice.client.contact_details.first.phone}
              %br
                Email: #{@invoice.client.contact_details.first.email}
    .col-xs-4.invoice-col
      %b
        Invoice #{@invoice.invoice_number}
      %br
        %br
          %b Payment Due:
          = l @invoice.paid_to_date
    .row
      .col-xs-12.table-responsive
        %table.table.table-striped
          %thead
            %tr
              %th.invoice_table_padding Qty
              %th Product
              %th Product Unit Price
              %th Description
              %th Discount
              %th Subtotal
          %tbody
            - @invoice.line_items.each do |line_item|
              %tr
                %td.invoice_table_padding= line_item.quantity.to_s
                %td= line_item.item.name
                %td= line_item.price
                %td= line_item.description
                %td= line_item.discount
                %td
                  = @invoice.currency_code.upcase
                  = number_with_precision(line_item.line_total, precision: 2)
  .row
    .col-xs-6
    .col-xs-6
      %p.lead
        Amount Due l #{@invoice.paid_to_date}
      .table-responsive
        %table.table
          %tbody
            %tr
              %th.invoice_table_width Subtotal:
              %td
                = @invoice.currency_code.upcase
                = number_with_precision(@invoice.sub_total, precision: 2)
            %tr
              %th Discount (%):
              %td= number_with_precision(@invoice.discount, precision: 2)
            - @taxes_data = get_taxes_data
            - @total = 0.00
            - @taxes_data.each do  |tax|
              - @total_amt = 0.0
              - @invoice.line_items.each do |line_item|
                - if line_item.tax1 == tax.id || line_item.tax2 == tax.id
                  - @amt = (line_item.line_total.to_f * (tax.rate.to_f / 100.00))
                  - @total_amt = @total_amt + @amt
                - if (line_item.tax_1.present? && tax.parent.present? && line_item.tax_1 == tax.parent) || (line_item.tax_2.present? && tax.parent.present? && line_item.tax_2 == tax.parent)
                  - @amt = (line_item.line_total.to_f * (tax.rate.to_f / 100.00))
                  - @total_amt = @total_amt + @amt
              - @total = @total + @total_amt
              %tr
                %th= "Tax (#{tax.rate}%) :"
                %td= number_with_precision(@total_amt, :precision => 2)
            %tr
              %th Total:
              %td
                = @invoice.currency_code.upcase
                = number_with_precision(@invoice.total_amount+@total, precision: 2)
  - unless is_pdf_view?
    .row.no-print
      .col-xs-12
        = link_to edit_invoice_path(@invoice), method: :get, class: "btn btn-primary btn-flat pull-right invoice_margin"  do
          %i.fa.fa-credit-card
          Edit
        = link_to new_invoice_payment_path(@invoice), class: "btn btn-primary btn-flat pull-right invoice_margin"  do
          %i.fa.fa-credit-card
          Make Payment
        = link_to invoice_generate_pdf_path(@invoice), method: :post, class: "btn btn-primary btn-flat pull-right invoice_margin"  do
          %i.fa.fa-download
          Download as PDF
