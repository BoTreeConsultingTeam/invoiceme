.nested-fields
  %tr
    %td.width20
      = f.select(:item_id, get_items, {:include_blank => true}, :onchange => "javascript:populate_values(this);", class: "width20")
    %td.width30
      =f.text_field :description, class: "width30"
    %td.width10
      = f.text_field :price, class: "width10", onblur: "javascript:change_price(this);"
    %td.width10
      = f.text_field :quantity, class: "width10", onblur: "javascript:change_quantity(this);"
    %td.width10
      = f.text_field :line_total, class: "width10"
    %td.width20
      = link_to_remove_association "remove line items", f, {class: "width20", :onclick => "javascript:remove_div(this);"}
:javascript

  function populate_values(ele)
  {
    split_values = $(ele).attr('id').split('_');
    $.ajax({
              type: 'POST',
              url: '/items/populate_values',
              data: {form_id: split_values[4], item_id: $(ele).val()},
              dataType: 'json',
              error: function(xhr, error){

              var invoice_total = parseFloat($("#invoice_total").val())-parseFloat($("#invoice_line_items_attributes_"+split_values[4]+"_line_total").val());
              if(invoice_total <= 0.01)
                invoice_total = 0.00
              $($("#invoice_total").val(invoice_total));
              $($("#invoice_line_items_attributes_"+split_values[4]+"_description").val(''));
              $($("#invoice_line_items_attributes_"+split_values[4]+"_price").val(''));
              $($("#invoice_line_items_attributes_"+split_values[4]+"_quantity").val(""));
              $($("#invoice_line_items_attributes_"+split_values[4]+"_line_total").val(''));

              },
              success: function (data) {
              var temp = 0.00;
              $($("#invoice_line_items_attributes_"+data["data"].form_id+"_description").val(data["data"].item.description));
              if($("#invoice_line_items_attributes_"+data["data"].form_id+"_price").val() != "")
                temp = parseFloat($("#invoice_line_items_attributes_"+data["data"].form_id+"_line_total").val());
              else
                temp = 0.00;
              $($("#invoice_line_items_attributes_"+data["data"].form_id+"_price").val(data["data"].item.price));
              $($("#invoice_line_items_attributes_"+data["data"].form_id+"_quantity").val("1"));
              var line_total = parseFloat(data["data"].item.price * 1)
              $($("#invoice_line_items_attributes_"+data["data"].form_id+"_line_total").val(line_total));
              var invoice_total = parseFloat($("#invoice_total").val())-temp+parseFloat(line_total);
              $($("#invoice_total").val(invoice_total));

              }
    });

  }
  function remove_div(ele)
  {
     var object = $(ele).closest(".nested-fields");
     var object1 = $(ele).prev("input[type=hidden]").attr('id');
     split_values = object1.toString().split('_');
     var line_total = $("#invoice_line_items_attributes_"+split_values[4]+"_line_total").val();
     if(parseFloat(line_total) > 0.00 && line_total.toString() != "NaN" && line_total.toString() != '')
     {
        var invoice_total = parseFloat($("#invoice_total").val())-parseFloat(line_total);
        $($("#invoice_total").val(invoice_total));
     }
  }